<!DOCTYPE html>
<html>
<head>
    <title>Movie Game</title>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            background-color: #f9f9f9;
        }
        .screen {
            display: none;
            height: 100vh;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .visible {
            display: flex;
        }
        .setup-container {
            display: flex;
            justify-content: space-between;
            width: 80%;
        }
        .section {
            width: 45%;
            padding: 1em;
        }
        .section h2 {
            margin-bottom: 0.5em;
        }
        button {
            padding: 0.5em 1em;
            margin: 0.5em;
        }
        .bottom-right {
            position: absolute;
            bottom: 20px;
            right: 20px;
        }
        .game-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            padding: 1em;
        }
        .game-info-left, .game-info-right {
            text-align: left;
        }
        .movie-input {
            flex-grow: 1;
            text-align: center;
        }
        .movie-input input {
            width: 60%;
            padding: 0.5em;
            font-size: 1em;
        }
        .game-middle {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 90%;
            margin-top: 2em;
        }
        .player-name {
            font-size: 1.2em;
            font-weight: bold;
            width: 15%;
            text-align: center;
        }
        .movie-stack {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60%;
        }
        .movie-box {
            border: 1px solid #ccc;
            padding: 1em;
            margin: 0.5em 0;
            width: 100%;
            background-color: #f1f1f1;
            border-radius: 8px;
            font-size: 0.9em;
        }

    </style>

    <script>
        let selectedWinCondition = "";

        function showScreen(id) {
            ['initialScreen', 'setupScreen', 'gameScreen'].forEach(screenId => {
                document.getElementById(screenId).classList.remove('visible');
            });
            document.getElementById(id).classList.add('visible');
        }

        function loadGameData() {
            fetch('/gamestate')
                .then(res => res.json())
                .then(data => {
                    document.getElementById("activePlayer").textContent = data.activePlayerName;
                    document.getElementById("winConditionDisplay").textContent = data.winCondition;
                    document.getElementById("roundCount").textContent = data.roundCount;
                });
        }

        function selectWinCondition(value) {
            selectedWinCondition = value;
            document.querySelectorAll('.win-button').forEach(btn => btn.style.backgroundColor = '');
            document.getElementById("win-" + value).style.backgroundColor = '#d1e7dd';
        }

        function submitSetup() {
            const player1 = document.getElementById("player1Name").value;
            const player2 = document.getElementById("player2Name").value;

            if (!player1 || !player2 || !selectedWinCondition) {
                alert("Please enter both names and select a win condition.");
                return;
            }

            fetch("/setup", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `player1=${encodeURIComponent(player1)}&player2=${encodeURIComponent(player2)}&winCondition=${encodeURIComponent(selectedWinCondition)}`
            })
                .then(response => {
                    if (response.ok) {
                        showScreen('gameScreen');
                        loadGameData();
                    } else {
                        alert("There was an error. Please try again.");
                    }
                });
        }
    </script>
</head>

<body>

<!-- Initial Screen -->
<div id="initialScreen" class="screen visible">
    <h1>Movie Connections Game</h1>
    <button onclick="showScreen('setupScreen')">Play</button>
</div>

<!-- Setup Screen -->
<div id="setupScreen" class="screen">
    <div class="setup-container">
        <!-- Left Side: Win Conditions -->
        <div class="section">
            <h2>Select the win condition:</h2>
            <button id="win-horror" class="win-button" onclick="selectWinCondition('horror')">Name four horror movies</button><br>
            <button id="win-comedy" class="win-button" onclick="selectWinCondition('comedy')">Name four comedies</button><br>
            <button id="win-action" class="win-button" onclick="selectWinCondition('action')">Name four action movies</button><br>
            <button id="win-sciFi" class="win-button" onclick="selectWinCondition('sciFi')">Name four science fiction movies</button>
            <br>
            <button id="win-drama" class="win-button" onclick="selectWinCondition('drama')">Name four dramas</button>
        </div>

        <!-- Right Side: Player Name -->
        <div class="section">
            <h2>Enter the name of Player #1:</h2>
            <input type="text" id="player1Name" placeholder="Player 1 Name" />
            <h2>Enter the name of Player #2:</h2>
            <input type="text" id="player2Name" placeholder="Player 2 Name" />

            <!-- Button inside this section -->
            <div style="margin-top: 1em;">
                <br>
                <br>
                <button onclick="submitSetup()">Continue</button>
            </div>
        </div>
    </div>
</div>



<!-- Game Screen -->
<div id="gameScreen" class="screen">
    <div class="game-top-bar">
        <div class="game-info-left">
            <p><b>Active Player:</b> <span id="activePlayer">Loading...</span></p>
            <!--<p><b>Active Player:</b> <span id="activePlayer" th:text="${activePlayer}">player1</span></p> -->
            <!--  <p><b>Active Player:</b> <span id="activePlayer">player1</span></p>  -->
            <p><b>Win Condition:</b> <span id="winConditionDisplay">[Win Condition]</span></p>
            <p><b>Rounds Played:</b> <span id="roundCount">0</span></p>
        </div>
        <div class="movie-input">
            <input type="text" id="movieInput" placeholder="Enter a movie..." />
        </div>
        <div class="game-info-right">
            <p><b>Time Left:</b> <span id="timer">30</span>s</p>
        </div>
    </div>

    <div class="game-middle">
        <div class="player-name" id="player1Box">Player 1</div>
        <div class="movie-stack">
            <!-- This can be generated dynamically with JS -->
            <div class="movie-box">Title: ...<br>Release Year: ...<br>Genre: ...<br>Link to previous: ...</div>
            <div class="movie-box">Empty</div>
            <div class="movie-box">Empty</div>
            <div class="movie-box">Empty</div>
            <div class="movie-box">Empty</div>
        </div>
        <div class="player-name" id="player2Box">Player 2</div>
    </div>
</div>


</body>
</html>
